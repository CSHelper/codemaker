<!doctype html>
<html lang="">
<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>web</title>

  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <!-- Place favicon.ico in the root directory -->

  <!-- build:css styles/vendor.css -->
  <!-- bower:css -->
  <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.css" />
  <!-- endbower -->
  <!-- endbuild -->

  <!-- build:css styles/main.css -->
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild -->

  <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/clientIO/joint/master/dist/joint.min.css">

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/clientIO/joint/master/dist/joint.min.js"></script>
</head>
<body >
    <!--[if lt IE 10]>
      <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->
      
      <ul class="nav navbar-nav">
        <li class="menu-item dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Drop Down<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li class="menu-item dropdown dropdown-submenu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Level 1</a>
              <ul class="dropdown-menu">
                <li class="menu-item ">
                  <a href="#">Link 1</a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>



      <div id="paper-html-elements"></div>
      <div id="myholder-small"></div>

      <ul id="canvas-menu" class="custom-menu">
        <li data-action="createRect">Create Rect</li>
      </ul>

      <ul id="rect-menu" class="custom-menu">
        <li data-action="makeLink">Link</li>
      </ul>

      <script type="text/javascript">
        var id = 1;
        var rects = {};

        var graph = new joint.dia.Graph;
        var paper = new joint.dia.Paper({ el: $('#paper-html-elements'), width: 650, height: 600, gridSize: 1, model: graph });
        var paperSmall = new joint.dia.Paper({ el: $('#myholder-small'), width: 650, height: 100, gridSize: 1, model: graph });
        paperSmall.scale(.5);
        paperSmall.$el.css('pointer-events', 'none');

        // Create a custom element.
        // ------------------------

        joint.shapes.html = {};
        joint.shapes.html.Element = joint.shapes.basic.Rect.extend({
          defaults: joint.util.deepSupplement({
            type: 'html.Element',
            attrs: {
              rect: { stroke: 'none', 'fill-opacity': 0 }
            }
          }, joint.shapes.basic.Rect.prototype.defaults)
        });

        // Create a custom view for that element that displays an HTML div above it.
        // -------------------------------------------------------------------------

        joint.shapes.html.ElementView = joint.dia.ElementView.extend({
          template: [
          '<div class="html-element">',
          '<button class="delete">x</button>',
          '<label></label>',
          '<span class="a-button">Edit</span>', '<br/>',
          '</div>',
          ].join(''),

          initialize: function() {
            _.bindAll(this, 'updateBox');
            joint.dia.ElementView.prototype.initialize.apply(this, arguments);
            this.$box = $(_.template(this.template)());
            // This is an example of reacting on the input change and storing the input data in the cell model
            this.$box.find('.delete').on('click', _.bind(this.model.remove, this.model));

            this.$box.find('.a-button').on('click', function (argument) {
              console.log("// body...");
            });

            // Update the box position whenever the underlying model changes.
            this.model.on('change', this.updateBox, this);
            // Remove the box when the model gets removed from the graph.
            this.model.on('remove', this.removeBox, this);

            this.updateBox();
          },
          render: function() {
            joint.dia.ElementView.prototype.render.apply(this, arguments);
            this.paper.$el.prepend(this.$box);
            this.updateBox();
            return this;
          },
          updateBox: function() {
            // Set the position and dimension of the box so that it covers the JointJS element.
            var bbox = this.model.getBBox();
            // Example of updating the HTML with a data stored in the cell model.
            this.$box.find('label').text(this.model.get('label'));

            this.$box.css({
              width: bbox.width,
              height: bbox.height,
              left: bbox.x,
              top: bbox.y,
              transform: 'rotate(' + (this.model.get('angle') || 0) + 'deg)'
            });
          },
          removeBox: function(evt) {
            this.$box.remove();
          }
        });

        function addRect(x, y) {
          var rectData = {
            id: id,
            name: 'Rect ' + id
          };
          rects[rectData.name] = rectData;
          id ++;

          var rect = new joint.shapes.html.Element({
            position: { x, y },
            size: { width: 170, height: 100 },
            label: rectData.name,
            rectData: rectData
          });

          graph.addCells([rect]);
        }

        // JAVASCRIPT (jQuery)
        // Trigger action when the contexmenu is about to be shown
        $('#paper-html-elements').bind("contextmenu", function (event) {
          // Avoid the real one
          event.preventDefault();
          
          // Show contextmenu
          $("#canvas-menu").finish().toggle(100).
          
          // In the right position (the mouse)
          css({
            top: event.pageY + "px",
            left: event.pageX + "px"
          });
        });

        $('svg g').bind("contextmenu", function (event) {
          console.log('hi');
          // Avoid the real one
          event.preventDefault();
          event.stopPropagation();

          // Show contextmenu
          $("#rect-menu").finish().toggle(100).
          
          // In the right position (the mouse)
          css({
            top: event.pageY + "px",
            left: event.pageX + "px"
          });
        });

        // If the document is clicked somewhere
        $(document).bind("mousedown", function (e) {
          if (!$(e.target).parents("#canvas-menu").length > 0) {
            // Hide it
            $("#canvas-menu").hide(100);
          }
          if (!$(e.target).parents("#rect-menu").length > 0) {
            // Hide it
            $("#rect-menu").hide(100);
          }
        });

        addRect(50, 50);

        $("#rect-menu li").click(function(){
          // This is the triggered action name
          switch($(this).attr("data-action")) {

            // A case for each action. Your actions here
            case "makeLink":
            addRect(0, 0);
            break;
          }

          // Hide it AFTER the action was triggered
          $("#rect-menu").hide(100);
        });

        // If the menu element is clicked
        $("#canvas-menu li").click(function(){
          // This is the triggered action name
          switch($(this).attr("data-action")) {

            // A case for each action. Your actions here
            case "createRect":
            addRect(0, 0);
            break;
            // case "second": alert("second"); break;
            // case "third": alert("third"); break;
          }

          // Hide it AFTER the action was triggered
          $("#canvas-menu").hide(100);
        });
      </script>

      <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
      <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
          function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='https://www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-XXXXX-X');ga('send','pageview');
      </script>

      <!-- build:js scripts/vendor.js -->
      <!-- bower:js -->
      <script src="/bower_components/jquery/dist/jquery.js"></script>
      <!-- endbower -->
      <!-- endbuild -->

      <!-- build:js scripts/plugins.js -->
      <script src="/bower_components/bootstrap/js/affix.js"></script>
      <script src="/bower_components/bootstrap/js/alert.js"></script>
      <script src="/bower_components/bootstrap/js/dropdown.js"></script>
      <script src="/bower_components/bootstrap/js/tooltip.js"></script>
      <script src="/bower_components/bootstrap/js/modal.js"></script>
      <script src="/bower_components/bootstrap/js/transition.js"></script>
      <script src="/bower_components/bootstrap/js/button.js"></script>
      <script src="/bower_components/bootstrap/js/popover.js"></script>
      <script src="/bower_components/bootstrap/js/carousel.js"></script>
      <script src="/bower_components/bootstrap/js/scrollspy.js"></script>
      <script src="/bower_components/bootstrap/js/collapse.js"></script>
      <script src="/bower_components/bootstrap/js/tab.js"></script>
      <!-- endbuild -->

      <!-- build:js scripts/main.js -->
      <script src="scripts/main.js"></script>
      <!-- endbuild -->
    </body>
    </html>
